<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Keycloak OAuth2 Token Helper</title>
    <style>
        body { font-family: sans-serif; padding: 2em; }
        pre { background-color: #eee; padding: 1em; white-space: pre-wrap; word-break: break-all; }
    </style>
</head>
<body>
    <h1>Keycloak OAuth2 Token Helper</h1>
    <div id="login-section">
        <p>Enter your Keycloak client details below and click the button to log in.</p>
        <div>
            <label for="clientId">Client ID:</label><br>
            <input type="text" id="clientId" value="web-client" style="width: 300px;"><br><br>
            <label for="clientSecret">Client Secret:</label><br>
            <input type="text" id="clientSecret" value="dpine2z9X29JN0M92iJM4rzbdR6upYHs" style="width: 300px;"><br><br>
        </div>
        <button id="login-btn">Login with Keycloak</button>
    </div>
    <div id="token-section" style="display: none;">
        <h2>Your Access Token:</h2>
        <pre id="access-token"></pre>
        <h2>Your Refresh Token:</h2>
        <pre id="refresh-token"></pre>
        <h2>Decoded Access Token:</h2>
        <pre id="decoded-token"></pre>
    </div>

    <script>
        const keycloakConfig = {
            url: 'http://keycloak.local:8081',
            realm: 'showcase',
            clientId: 'web-client',
            clientSecret: 'dpine2z9X29JN0M92iJM4rzbdR6upYHs', // WARNING: See security note in instructions.
            redirectUri: window.location.origin + window.location.pathname
        };

        const loginButton = document.getElementById('login-btn');
        const loginSection = document.getElementById('login-section');
        const tokenSection = document.getElementById('token-section');
        const accessTokenElem = document.getElementById('access-token');
        const refreshTokenElem = document.getElementById('refresh-token');
        const decodedTokenElem = document.getElementById('decoded-token');

        const clientIdInput = document.getElementById('clientId');
        const clientSecretInput = document.getElementById('clientSecret');

        loginButton.onclick = () => {
            const clientId = clientIdInput.value;
            const authUrl = `${keycloakConfig.url}/realms/${keycloakConfig.realm}/protocol/openid-connect/auth?client_id=${clientId}&redirect_uri=${encodeURIComponent(keycloakConfig.redirectUri)}&response_type=code&scope=openid`;
            window.location.href = authUrl;
        };

        function decodeJwt(token) {
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                return JSON.stringify(JSON.parse(jsonPayload), null, 2);
            } catch (e) {
                return "Error decoding token: " + e;
            }
        }

        window.onload = () => {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');

            if (code) {
                loginSection.style.display = 'none';
                tokenSection.style.display = 'block';

                const clientId = clientIdInput.value;
                const clientSecret = clientSecretInput.value;

                const tokenUrl = `${keycloakConfig.url}/realms/${keycloakConfig.realm}/protocol/openid-connect/token`;
                const params = new URLSearchParams();
                params.append('grant_type', 'authorization_code');
                params.append('client_id', clientId);
                params.append('client_secret', clientSecret);
                params.append('code', code);
                params.append('redirect_uri', keycloakConfig.redirectUri);

                fetch(tokenUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: params
                })
                .then(response => response.json())
                .then(data => {
                    if (data.access_token) {
                        accessTokenElem.textContent = data.access_token;
                        refreshTokenElem.textContent = data.refresh_token || 'N/A';
                        decodedTokenElem.textContent = decodeJwt(data.access_token);
                    } else {
                        accessTokenElem.textContent = JSON.stringify(data, null, 2);
                    }
                })
                .catch(error => {
                    accessTokenElem.textContent = 'Error fetching token: ' + error;
                });
            }
        };
    </script>
</body>
</html>
